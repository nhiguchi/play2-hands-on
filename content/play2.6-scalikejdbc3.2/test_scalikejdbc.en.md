---
title: Test ScalikeJDBC
---

scalikejdbcGen also generates corresponding test code while generating the model source code. The test code is located in the `test/models` package.

Let's edit this test code a bit and actually run the tests.
We will be using the already created test DB file `h2 / test.mv.db`.

First, add the scalikejdbc-test library to `build.sbt`.

```scala
libraryDependencies += "org.scalikejdbc" %% "scalikejdbc-test" % "3.2.2" % Test
```

Next, load the test DB. There are several methods to do so, but this time we will create a file named `conf/test.conf` with the following contents.

```properties
include "application.conf"

db.default.url="jdbc:h2:tcp://localhost/test"
```

Add the following line to `build.sbt` to read the above settings in test.

```scala
javaOptions in Test += "-Dconfig.file=conf/test.conf"
```

Add the setup processing to the test code.

```scala
class UsersSpec extends fixture.FlatSpec with Matchers with AutoRollback {
  // initialize
  config.DBs.setup()

  val u = Users.syntax("u")
  ...
}
```

```scala
class CompaniesSpec extends fixture.FlatSpec with Matchers with AutoRollback {
  // initialize
  config.DBs.setup()

  val c = Companies.syntax("c")
  ...
}
```

Finally, modify the test case to match the hands-on format.

The test for the `save` method in` UsersSpec` is left as TODO as following.

```scala
it should "save a record" in { implicit session =>
  val entity = Users.findAll().head
  // TODO modify something
  val modified = entity
  val updated = Users.save(modified)
  updated should not equal(entity)
}
```

Modify the value.

```scala
it should "save a record" in { implicit session =>
  val entity = Users.findAll().head
  // change the name
  val modified = entity.copy(name = "modify")
  val updated = Users.save(modified)
  updated should not equal(entity)
}
```

Similarly, modify the `CompaniesSpec`.

```scala
it should "save a record" in { implicit session =>
  val entity = Companies.findAll().head
  // change the name
  val modified = entity.copy(name = "modify")
  val updated = Companies.save(modified)
  updated should not equal(entity)
}
```


In addition, `CompaniesSpec` has several tests that will fail, such as searching for non-existing IDs. Use a test fixture to eliminate those.
In ScalikeJDBC, you can set the test fixture by overriding the `fixture` method as follows.

```scala
class CompaniesSpec extends fixture.FlatSpec with Matchers with AutoRollback {
  config.DBs.setup()

  // Rollback everything at the end of the test
  override def fixture(implicit session: DBSession) {
    SQL("insert into COMPANIES values (?, ?)").bind(123, "test_company1").update.apply()
    SQL("insert into COMPANIES values (?, ?)").bind(234, "test_company2").update.apply()
  }

  ...

  it should "create new record" in { implicit session =>
    // Specify a unique ID
    val created = Companies.create(id = 999, name = "MyString")
    created should not be(null)
  }

  ...

  it should "destroy a record" in { implicit session =>
    // Data generated by fixtures can be deleted
    val entity = Companies.find(123).get
    val deleted = Companies.destroy(entity)
    deleted should be(1)
    val shouldBeNone = Companies.find(123)
    shouldBeNone.isDefined should be(false)
  }
  it should "perform batch insert" in { implicit session =>
    // Batch update the data generated by the fixture
    val entities = Companies.findAllBy(sqls.in(c.id, Seq(123, 234)))
    entities.foreach(e => Companies.destroy(e))
    val batchInserted = Companies.batchInsert(entities)
    batchInserted.size should be >(0)
  }
}
```

Run test

```
sbt test
```

All the tests should succeed as shown below.

```
[info] Total number of tests run: 23
[info] Suites: completed 3, aborted 0
[info] Tests: succeeded 23, failed 0, canceled 0, ignored 0, pending 0
[info] All tests passed.
[info] Passed: Total 23, Failed 0, Errors 0, Passed 23
```

Running a specific test

```
sbt "testOnly models.CompaniesSpec"
```

The following document for ScalikeJDBC unit tests reference.

- https://github.com/scalikejdbc/scalikejdbc-cookbook/blob/master/ja/08_unittest.md
